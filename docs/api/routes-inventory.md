# Route Inventory

This is the source-of-truth route map from `server/app.js` and `server/routes/*`.

| Method | Full path                     | Route anchor                                                               | Handler anchor                                                                  | Auth middleware chain anchor                                                                                | Validation/schema anchor                                                                                                               |
| ------ | ----------------------------- | -------------------------------------------------------------------------- | ------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| GET    | `/api/square/_ping`           | `server/app.js :: app.get('/api/square/_ping', ...)`                       | `server/app.js :: inline handler`                                               | None                                                                                                        | None                                                                                                                                   |
| POST   | `/api/square/webhook`         | `server/app.js :: app.post('/api/square/webhook', ...)`                    | `server/controllers/webhookController.js :: squareWebhookHandler`               | `server/app.js :: express.raw(...)` + `server/middleware/verifySquareSignature.js :: verifySquareSignature` | Signature check logic in `server/middleware/verifySquareSignature.js :: verifySquareSignature`                                         |
| POST   | `/api/auth/register`          | `server/routes/authRoutes.js :: router.post('/register', ...)`             | `server/controllers/authController.js :: registerUser`                          | `server/routes/authRoutes.js :: authLimiter`                                                                | `server/schemas/authSchema.js :: authRegisterSchema`                                                                                   |
| POST   | `/api/auth/login`             | `server/routes/authRoutes.js :: router.post('/login', ...)`                | `server/controllers/authController.js :: loginUser`                             | `server/routes/authRoutes.js :: authLimiter`                                                                | `server/schemas/authSchema.js :: authLoginSchema`                                                                                      |
| POST   | `/api/auth/logout`            | `server/routes/authRoutes.js :: router.post('/logout', ...)`               | `server/controllers/authController.js :: logoutUser`                            | None                                                                                                        | None                                                                                                                                   |
| GET    | `/api/auth/me`                | `server/routes/authRoutes.js :: router.get('/me', ...)`                    | `server/controllers/authController.js :: getCurrentUser`                        | `server/middleware/authMiddleware.js :: protect`                                                            | None                                                                                                                                   |
| POST   | `/api/auth/google`            | `server/routes/authRoutes.js :: router.post('/google', ...)`               | `server/controllers/googleAuthController.js :: googleAuth`                      | None                                                                                                        | `server/schemas/googleAuthSchema.js :: googleAuthSchema`                                                                               |
| POST   | `/api/auth/request-code`      | `server/routes/authRoutes.js :: router.post('/request-code', ...)`         | `server/controllers/requestCodeController.js :: requestLoginCode`               | `server/routes/authRoutes.js :: authLimiter`                                                                | `server/schemas/loginCodeSchemas.js :: requestLoginCodeSchema`                                                                         |
| POST   | `/api/auth/verify-code`       | `server/routes/authRoutes.js :: router.post('/verify-code', ...)`          | `server/controllers/verifyCodeController.js :: verifyCode`                      | `server/routes/authRoutes.js :: authLimiter`                                                                | `server/schemas/loginCodeSchemas.js :: verifyLoginCodeSchema`                                                                          |
| PATCH  | `/api/auth/reset-password`    | `server/routes/authRoutes.js :: router.patch('/reset-password', ...)`      | `server/controllers/resetPasswordController.js :: resetPassword`                | `server/middleware/authMiddleware.js :: protect` + `server/routes/authRoutes.js :: authLimiter`             | `server/schemas/passwordResetSchema.js :: passwordResetSchema`                                                                         |
| POST   | `/api/auth/refresh`           | `server/routes/authRoutes.js :: router.post('/refresh', ...)`              | `server/controllers/refreshController.js :: refreshSession`                     | Cookie refresh flow in controller                                                                           | None                                                                                                                                   |
| GET    | `/api/books/`                 | `server/routes/bookRoutes.js :: router.get('/', ...)`                      | `server/controllers/bookController.js :: getBooks`                              | `server/middleware/optionalAuth.js :: optionalAuth`                                                         | `server/schemas/paginationSchema.js :: booksQuerySchema`                                                                               |
| GET    | `/api/books/:id`              | `server/routes/bookRoutes.js :: router.get('/:id', ...)`                   | `server/controllers/bookController.js :: getBookById`                           | `server/middleware/optionalAuth.js :: optionalAuth`                                                         | `server/schemas/paramsSchemas.js :: idParamSchema`                                                                                     |
| GET    | `/api/books/partner-books`    | `server/routes/bookRoutes.js :: router.get('/partner-books', ...)`         | `server/controllers/bookController.js :: getPartnerBooks`                       | `server/middleware/authMiddleware.js :: protect` + `server/middleware/requireRole.js :: requireRole`        | `server/schemas/paginationSchema.js :: partnerBooksQuerySchema`                                                                        |
| POST   | `/api/books/check-stock`      | `server/routes/bookRoutes.js :: router.post('/check-stock', ...)`          | `server/controllers/bookController.js :: checkStock`                            | `server/middleware/authMiddleware.js :: protect`                                                            | Controller-level checks only (`server/controllers/bookController.js :: checkStock`)                                                    |
| POST   | `/api/books/`                 | `server/routes/bookRoutes.js :: router.post('/', ...)`                     | `server/controllers/bookController.js :: createBook`                            | `server/middleware/authMiddleware.js :: protect` + `server/middleware/authMiddleware.js :: isAdmin`         | `server/schemas/bookSchema.js :: createBookSchema`                                                                                     |
| PUT    | `/api/books/:id`              | `server/routes/bookRoutes.js :: router.put('/:id', ...)`                   | `server/controllers/bookController.js :: updateBook`                            | `server/middleware/authMiddleware.js :: protect` + `server/middleware/authMiddleware.js :: isAdmin`         | `server/schemas/paramsSchemas.js :: idParamSchema` + `server/schemas/bookSchema.js :: updateBookSchema`                                |
| DELETE | `/api/books/:id`              | `server/routes/bookRoutes.js :: router.delete('/:id', ...)`                | `server/controllers/bookController.js :: deleteBook`                            | `server/middleware/authMiddleware.js :: protect` + `server/middleware/authMiddleware.js :: isAdmin`         | `server/schemas/paramsSchemas.js :: idParamSchema`                                                                                     |
| GET    | `/api/search`                 | `server/routes/searchRoutes.js :: router.get('/search', ...)`              | `server/controllers/searchController.js :: searchBooks`                         | `server/middleware/optionalAuth.js :: optionalAuth`                                                         | None                                                                                                                                   |
| GET    | `/api/favorites/`             | `server/routes/favoriteRoutes.js :: router.get('/', ...)`                  | `server/controllers/favoriteController.js :: getFavorites`                      | `server/routes/favoriteRoutes.js :: router.use(protect)`                                                    | None                                                                                                                                   |
| POST   | `/api/favorites/`             | `server/routes/favoriteRoutes.js :: router.post('/', ...)`                 | `server/controllers/favoriteController.js :: addFavorite`                       | `server/routes/favoriteRoutes.js :: router.use(protect)`                                                    | `server/schemas/favoriteSchema.js :: addFavoriteSchema`                                                                                |
| DELETE | `/api/favorites/:bookId`      | `server/routes/favoriteRoutes.js :: router.delete('/:bookId', ...)`        | `server/controllers/favoriteController.js :: removeFavorite`                    | `server/routes/favoriteRoutes.js :: router.use(protect)`                                                    | `server/schemas/paramsSchemas.js :: uuidParamSchema`                                                                                   |
| GET    | `/api/cart/`                  | `server/routes/cartRoutes.js :: router.get('/', ...)`                      | `server/controllers/cartController.js :: getCart`                               | `server/routes/cartRoutes.js :: router.use(protect)`                                                        | None                                                                                                                                   |
| POST   | `/api/cart/`                  | `server/routes/cartRoutes.js :: router.post('/', ...)`                     | `server/controllers/cartController.js :: addToCart`                             | `server/routes/cartRoutes.js :: router.use(protect)`                                                        | Controller-level schema: `server/schemas/cartSchemas.js :: addToCartSchema`                                                            |
| PATCH  | `/api/cart/:itemId`           | `server/routes/cartRoutes.js :: router.patch('/:itemId', ...)`             | `server/controllers/cartController.js :: updateQuantity`                        | `server/routes/cartRoutes.js :: router.use(protect)`                                                        | `server/schemas/paramsSchemas.js :: cartItemIdParamSchema` + controller schema `server/schemas/cartSchemas.js :: updateQuantitySchema` |
| DELETE | `/api/cart/:itemId`           | `server/routes/cartRoutes.js :: router.delete('/:itemId', ...)`            | `server/controllers/cartController.js :: deleteItem`                            | `server/routes/cartRoutes.js :: router.use(protect)`                                                        | `server/schemas/paramsSchemas.js :: cartItemIdParamSchema`                                                                             |
| DELETE | `/api/cart/`                  | `server/routes/cartRoutes.js :: router.delete('/', ...)`                   | `server/controllers/cartController.js :: clearCart`                             | `server/routes/cartRoutes.js :: router.use(protect)`                                                        | None                                                                                                                                   |
| POST   | `/api/orders/`                | `server/routes/orderRoutes.js :: router.post('/', ...)`                    | `server/controllers/orderController.js :: createOrder`                          | `server/routes/orderRoutes.js :: router.use(protect)`                                                       | None                                                                                                                                   |
| GET    | `/api/orders/`                | `server/routes/orderRoutes.js :: router.get('/', ...)`                     | `server/controllers/orderController.js :: getUserOrders`                        | `server/routes/orderRoutes.js :: router.use(protect)`                                                       | None                                                                                                                                   |
| GET    | `/api/orders/latest`          | `server/routes/orderRoutes.js :: router.get('/latest', ...)`               | `server/controllers/orderController.js :: getLatestOrder`                       | `server/routes/orderRoutes.js :: router.use(protect)`                                                       | None                                                                                                                                   |
| POST   | `/api/orders/confirm`         | `server/routes/orderRoutes.js :: router.post('/confirm', ...)`             | `server/controllers/orderController.js :: confirmSquareOrder`                   | `server/routes/orderRoutes.js :: router.use(protect)`                                                       | None                                                                                                                                   |
| GET    | `/api/orders/all`             | `server/routes/orderRoutes.js :: router.get('/all', ...)`                  | `server/controllers/orderController.js :: getAllOrders`                         | `server/routes/orderRoutes.js :: router.use(protect)` + `server/middleware/requireRole.js :: requireRole`   | None                                                                                                                                   |
| PATCH  | `/api/orders/:id/status`      | `server/routes/orderRoutes.js :: router.patch('/:id/status', ...)`         | `server/controllers/orderController.js :: updateOrderStatus`                    | `server/routes/orderRoutes.js :: router.use(protect)` + `server/middleware/requireRole.js :: requireRole`   | `server/schemas/paramsSchemas.js :: idParamSchema` + `server/schemas/orderSchemas.js :: updateOrderStatusSchema`                       |
| DELETE | `/api/orders/:id`             | `server/routes/orderRoutes.js :: router.delete('/:id', ...)`               | `server/controllers/orderController.js :: deleteOrder`                          | `server/routes/orderRoutes.js :: router.use(protect)` + `server/middleware/requireRole.js :: requireRole`   | `server/schemas/paramsSchemas.js :: idParamSchema`                                                                                     |
| GET    | `/api/pages/:slug`            | `server/routes/pagesRoutes.js :: router.get('/:slug', ...)`                | `server/controllers/pagesController.js :: getPage`                              | `server/middleware/optionalAuth.js :: optionalAuth`                                                         | `server/schemas/paramsSchemas.js :: slugParamSchema`                                                                                   |
| GET    | `/api/pages/:slug/versions`   | `server/routes/pagesRoutes.js :: router.get('/:slug/versions', ...)`       | `server/routes/pagesRoutes.js :: inline ctrlWrapper(async (req,res)=>...)`      | `server/middleware/authMiddleware.js :: protect` + `server/middleware/requireRole.js :: requireRole`        | `server/schemas/paramsSchemas.js :: slugParamSchema`                                                                                   |
| PUT    | `/api/pages/:slug/draft`      | `server/routes/pagesRoutes.js :: router.put('/:slug/draft', ...)`          | `server/controllers/pagesController.js :: saveDraft`                            | `server/middleware/authMiddleware.js :: protect` + `server/middleware/requireRole.js :: requireRole`        | `server/schemas/pageSchemas.js :: draftPageSchema`                                                                                     |
| PUT    | `/api/pages/:slug`            | `server/routes/pagesRoutes.js :: router.put('/:slug', ...)`                | `server/controllers/pagesController.js :: updatePage`                           | `server/middleware/authMiddleware.js :: protect` + `server/middleware/requireRole.js :: requireRole`        | `server/schemas/pageSchemas.js :: publishPageSchema`                                                                                   |
| POST   | `/api/pages/`                 | `server/routes/pagesRoutes.js :: router.post('/', ...)`                    | `server/controllers/pagesController.js :: createPage`                           | `server/middleware/authMiddleware.js :: protect` + `server/middleware/requireRole.js :: requireRole`        | `server/schemas/pageSchemas.js :: createPageSchema`                                                                                    |
| POST   | `/api/contact/`               | `server/routes/contactRoutes.js :: router.post('/', ...)`                  | `server/controllers/contactController.js :: sendContactEmail`                   | None                                                                                                        | `server/schemas/contactSchema.js :: contactSchema`                                                                                     |
| POST   | `/api/newsletter/subscribe`   | `server/routes/newsletterRoutes.js :: router.post('/subscribe', ...)`      | `server/controllers/newsletterController.js :: subscribe`                       | None                                                                                                        | `server/schemas/newsletterSchemas.js :: subscribeSchema`                                                                               |
| POST   | `/api/newsletter/unsubscribe` | `server/routes/newsletterRoutes.js :: router.post('/unsubscribe', ...)`    | `server/controllers/newsletterController.js :: unsubscribe`                     | None                                                                                                        | `server/schemas/newsletterSchemas.js :: subscribeSchema`                                                                               |
| POST   | `/api/newsletter/send`        | `server/routes/newsletterRoutes.js :: router.post('/send', ...)`           | `server/controllers/newsletterController.js :: sendNewsletter`                  | `server/middleware/authMiddleware.js :: protect` + `server/middleware/requireRole.js :: requireRole`        | `server/schemas/newsletterSchemas.js :: sendSchema`                                                                                    |
| POST   | `/api/square/create-payment`  | `server/routes/squareRoutes.js :: router.post('/create-payment', ...)`     | `server/controllers/squareController.js :: createPayment`                       | `server/middleware/authMiddleware.js :: protect`                                                            | Controller-level schema: `server/controllers/squareController.js :: paymentSchema`                                                     |
| POST   | `/api/images/upload`          | `server/routes/imageRoutes.js :: router.post('/upload', ...)`              | `server/routes/imageRoutes.js :: inline handler in router.post('/upload', ...)` | `server/middleware/authMiddleware.js :: protect`                                                            | Multipart upload middleware: `server/middleware/uploadMiddleware.js :: upload.single('image')`                                         |
| PATCH  | `/api/me/`                    | `server/routes/userSelfRoutes.js :: router.patch('/', ...)`                | `server/controllers/userSelfController.js :: updateMe`                          | `server/routes/userSelfRoutes.js :: router.use(protect)`                                                    | `server/schemas/meSchemas.js :: userSelfUpdateSchema`                                                                                  |
| PATCH  | `/api/me/avatar`              | `server/routes/userSelfRoutes.js :: router.patch('/avatar', ...)`          | `server/controllers/userSelfController.js :: updateAvatar`                      | `server/routes/userSelfRoutes.js :: router.use(protect)`                                                    | Multipart upload middleware (`upload.single('avatar')`)                                                                                |
| PATCH  | `/api/me/partner-profile`     | `server/routes/userSelfRoutes.js :: router.patch('/partner-profile', ...)` | `server/controllers/userSelfController.js :: upsertMyPartnerProfile`            | `server/routes/userSelfRoutes.js :: router.use(protect)`                                                    | `server/schemas/meSchemas.js :: partnerProfileUpsertSchema`                                                                            |
| GET    | `/api/users/`                 | `server/routes/userRoutes.js :: router.get('/', ...)`                      | `server/controllers/userController.js :: getAllUsers`                           | `server/routes/userRoutes.js :: router.use(protect, isAdminOrSuperAdmin, logSuperAdminAccess)`              | None                                                                                                                                   |
| PATCH  | `/api/users/:id/role`         | `server/routes/userRoutes.js :: router.patch('/:id/role', ...)`            | `server/controllers/userController.js :: updateUserRole`                        | `server/routes/userRoutes.js :: router.use(protect, isAdminOrSuperAdmin, logSuperAdminAccess)`              | `server/schemas/paramsSchemas.js :: idParamSchema` + `server/schemas/userRoleSchema.js :: userRoleSchema`                              |
| DELETE | `/api/users/:id`              | `server/routes/userRoutes.js :: router.delete('/:id', ...)`                | `server/controllers/userController.js :: deleteUser`                            | `server/routes/userRoutes.js :: router.use(protect, isAdminOrSuperAdmin, logSuperAdminAccess)`              | `server/schemas/paramsSchemas.js :: idParamSchema`                                                                                     |

## Notes

- `server/app.js` also mounts `imageRoutes` at `/images`, creating `/images/upload` as an additional non-`/api` alias.
- `GET /__static_check` exists but is outside `/api/*`.
